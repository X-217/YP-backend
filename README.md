# YP-backend

Разработка backend для учебного проекта 'Mesto'.

Приложение развернуто на http://x-217.ru  ( https://x-217.ru, http://84.201.132.115)

------------

### Основные используемые технологии:
- node.js
- express
- mongoDB
------------

## Этапы разработки:

#### "Проектная работа 12" - выполнено, принято

1. Создан проект
2. Настроены editorconfig и eslint
3. Создан git репозиторий
4. Создана точка входа
5. Настроена раздача статики сервером
6. Создана структура проекта

 #### "Проектная работа 13" - выполнено, принято
 
 1. Реализовано подключение к MongoDB
 2. Созданы схемы и модели
 3. Созданы контроллеры и роуты для пользователей
 4. Реализована временная авторизация
 5. Созданы контроллеры и роуты для карточек
 6. Удален фронтенд
 7. Созданы роуты для реализации изменений пользователей и карточек
  
 #### "Проектная работа 14" - выполнено, принято
 
1. Добавлены email и password к схеме пользователя
2. Переработан контроллер createUser
3. Создан контроллер login
4. Создан роут для логина и регистрации
5. Создан мидлвэр для авторизации
6. Реализована защита API авторизацией
7. Удалена временная авторизация
8. Реализован контроль прав изменения карточек
9. API не возвращает хеш пароля
 
 #### "Проектная работа 15" - ожидание код-ревью
 
 1. Реализована централизованная обработка ошибок
 2. Добавлена валидация запросы
 3. Реализовано логгирование запросов и ошибок
 4. Создан облачный сервер и на нем развернуто API
 5. Создан домен и прикреплен к серверу
 6. Выпущены и подключены сертификаты
 7. На сервере  создан .env файл с переменными окружения
 8. Добавлен краш-тест сервера
 
------------

## Запуск проекта

Клонируйте репозиторий

https://github.com/X-217/YP-backend.git

Установите зависимости

`npm install`

Запустите сервер

`npm run start`

Для запуска с **hot reload**

`npm run dev`

------------

Для тестирования работы приложения используйте Postman: https://www.postman.com/downloads/

##### Создание нового пользователя

```html
POST http://localhost:3000/signup
```
Образец объекта для создания нового пользователя:
```json
{
"name" : "Тестовый пользователь",
"about" : "Информация о себе",
"avatar" :"https://icdn.lenta.ru/images/2020/05/27/00/20200527004126544/pic_2878afc7e709e103ad0db9b17361affa.jpg",
"email" : "qwerty@ya.ru",
"password" : "12345678"
}
```
------------
##### Авторизация пользователя

```html
POST http://localhost:3000/signin
```

Образец объекта для авторизации пользователя:
```json
{
"email" : "qwerty@ya.ru",
"password" : "12345678"
}
```

------------


##### Обновление профиля пользователя

( доступно только после авторизации )

```html
PATCH http://localhost:3000/users/me
```

Образец объекта для обновления профиля пользователя:
```json
{
"name" : "Измененнный пользователь",
"about" : "Новая информация"
}
```

------------

##### Обновление аватара пользователя

( доступно только после авторизации )

```html
PATCH http://localhost:3000/users/me/avatar
```

Образец объекта для обновления профиля пользователя:
```json
{
"avatar" :"https://icdn.lenta.ru/images/2020/06/01/18/20200601184316731/pic_216553662d40f3beceedb25edbdf75dc.png"
}
```

------------

##### Получить JSON объект пользователя по ID

( доступно только после авторизации )

```html
GET http://localhost:3000/users/:userId
```

------------

##### Получить JSON объект со всеми пользователями

( доступно только после авторизации )

```html
GET http://localhost:3000/users
```

------------

##### Создать карточку места

( доступно только после авторизации )

```html
POST http://localhost:3000/cards
```

Образец объекта для создания новой карточки:

```json
{
    "name": "Moscow",
    "link": "https://avatars.mds.yandex.net/get-pdb/1016500/f2c63605-9779-4894-afc2-8210dd16b250/s1200?webp=false"
}
```

------------

##### Поставить лайк карточке (по ID карточки)

( доступно только после авторизации )

```html
PUT http://localhost:3000/cards/:cardId/likes
```

------------
##### Убрать лайк с карточки (по ID карточки)

( доступно только после авторизации )

```html
DELETE http://localhost:3000/cards/:cardId/likes
```

------------
##### Удалить карточку (по ID карточки)

( доступно только после авторизации )

```html
DELETE http://localhost:3000/cards/:cardId
```

------------

##### Получить JSON объект со всеми карточками

( доступно только после авторизации )

```html
GET http://localhost:3000/cards
```

#### Чек лист проверки:

##### Операции с пользователями

1) Coздать нового пользователя / выполнено
2) Попытаться создать еще одного с такими же данными, контроль ошибок / выполнено, 400
3) Попытаться создать еще одного, с пустым полем name , контроль ошибок / выполнено, 400
4) Попытаться создать еще одного, с некорректным объектом (без поля password), контроль ошибок / выполнено, 400
5) Сoздать еще одного пользователя / выполнено
7) Выполнить авторизацию 1-го пользователя, контроль куки / выполнено
8) Разлогиниться (удалить куку) /выполнено
9) Попытаться выполнить авторизацию с неправильным email контроль куки и ошибок/ выполнено, отсутствует, 400
10) Попытаться выполнить авторизацию с неправильным password контроль куки и ошибок/ выполнено, отсутствует, 400
11) Попытаться выполнить авторизацию с невалидным email контроль куки и ошибок/ выполнено, отсутствует, 400
12) Попытаться выполнить авторизацию с невалидным password контроль куки и ошибок/ выполнено, отсутствует, 400
13) Выполнить авторизацию 2-го пользователя, контроль куки / выполнено
14) Получить объект пользователя по ID / выполнено
15) Попытаться получить объект пользователя по несуществующему ID, контроль ошибок / выполнено, 400
16) Попытаться получить объект пользователя по невалидному ID, контроль ошибок / выполнено, 400
17) Получить JSON объект со всеми пользователями /выполнено
18) Удалить 1-го пользователя (в MongoDB) /выполнено 
19) Попытаться получить объект удаленного пользователя, контроль ошибок / выполнено, 400
20) Создать еще одного пользователя / выполнено
21) Выполнить авторизацию под новым пользователем / выполнено
22) Обновить профиль пользователя / выполнено
23) Попытаться обновить профиль с некорректным объектом (без поля about), контроль ошибок / выполнено, 400
24) Попытаться обновить профиль с невалидным объектом (пустое поле name), контроль ошибок / выполнено, 400
25) Удалить авторизованного пользователя (в MongoDB) /выполнено 
26) Попытаться обновить профиль удаленного пользователя, контроль ошибок / выполнено, 400
27) Выполнить авторизацию под оставшимся пользователем / выполнено
28) Обновить аватар пользователя / выполнено
29) Попытаться обновить аватар с некорректным объектом (пустой объект), контроль ошибок / выполнено, 400
30) Попытаться обновить аватар с невалидным объектом (поле avatar), контроль ошибок / выполнено, 400
31) Удалить авторизованного пользователя (в MongoDB) /выполнено 
32) Попытаться обновить аватар удаленного пользователя, контроль ошибок / выполнено, 400

##### Операции с карточками

1) Создать 2-х пользователей, залогиниться под первым
2) Создать карточку места, контроль owner / выполнено
3) Попытаться создать карточку места без поля name, контроль ошибок / выполнено, 400
4) Попытаться создать карточку места с некорректным link / выполнено, 400
5) Создать еще одну карточку места / выполнено
6) Разлогиниться (удалить куку) /выполнено
7) Выполнить авторизацию 2-го пользователя, контроль куки / выполнено
8) Создать еще две карточки места, контроль owner / выполнено
9) Поставить лайк своей карточке / выполнено
10) Поставить лайк той же карточке, контроль невозможности нескольких лайков от одного пользователя  / выполнено, 400
11) Поставить лайк чужой карточке / выполнено
12) Попытаться поставить лайк несуществующей карточке (некорректный ID), контроль ошибки/ выполнено, 400
13) Попытаться поставить лайк несуществующей карточке (невалидный ID), контроль ошибки/ выполнено, 400
14) Дизлайк своей карточке / выполнено
15) Дизлайк той же карточке, контроль невозможности нескольких дизлайков от одного пользователя  / выполнено, 400
16) Дизлайк чужой карточке / выполнено
17) Попытаться поставить дизлайк несуществующей карточке (некорректный ID), контроль ошибки/ выполнено, 400
18) Попытаться поставить дизлайк несуществующей карточке (невалидный ID), контроль ошибки/ выполнено, 400
19) Поставить лайк своей карточке / выполнено
20) Поставить лайк чужой карточке / выполнено
21) Удалить свою карточку / выполнено
22) Попытаться повторно удалить эту же карточку, контроль ошибок / выполнено, 400
23) Попытаться удалить карточку с некорректным ID, контроль ошибок / выполнено, 400
24) Попытаться удалить карточку с несуществующим ID, контроль ошибок / выполнено, 400
25) Попытаться поставить лайк удаленной карточке, контроль ошибок / выполнено, 400
26) Попытаться поставить дизлайк удаленной карточке, контроль ошибок / выполнено, 400
27) Попытаться удалить чужую карточку, контроль ошибок / выполнено, 400
28) Сменить пользователя
29) Попытаться поставить дизлайк (снять чужой лайк) карточке, контроль ошибки/ выполнено, 400
30) Получить JSON объект со всеми карточками / выполнено
31) Разлогиниться (удалить куку) /выполнено
32) Попытаться получить JSON объект со всеми карточками, контроль ошибок / выполнено, 400
